{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/armob_github_actions","result":{"data":{"markdownRemark":{"html":"<p><a style=\"background-color:black;color:white;text-decoration:none;padding:4px 6px;font-family:-apple-system, BlinkMacSystemFont, &quot;San Francisco&quot;, &quot;Helvetica Neue&quot;, Helvetica, Ubuntu, Roboto, Noto, &quot;Segoe UI&quot;, Arial, sans-serif;font-size:12px;font-weight:bold;line-height:1.2;display:inline-block;border-radius:3px\" href=\"https://unsplash.com/@jakobowens1?utm_medium=referral&amp;utm_campaign=photographer-credit&amp;utm_content=creditBadge\" target=\"_blank\" rel=\"noopener noreferrer\" title=\"Download free do whatever you want high-resolution photos from Jakob Owens\"><span style=\"display:inline-block;padding:2px 3px\"><svg xmlns=\"http://www.w3.org/2000/svg\" style=\"height:12px;width:auto;position:relative;vertical-align:middle;top:-2px;fill:white\" viewBox=\"0 0 32 32\"><title>unsplash-logo</title><path d=\"M10 9V0h12v9H10zm12 5h10v18H0V14h10v9h12v-9z\"></path></svg></span><span style=\"display:inline-block;padding:2px 3px\">Jakob Owens</span></a></p>\n<h2>Biographical Blah-blah-blah</h2>\n<p>As a mostly self-taught hacker without much in the way of 1337 coding skillz, I've been having to figure out workflow as I go.  I learned coding with Pascal and C++ in the 90s before there was anything like automated testing or continuous integration/continuous deployment.  You just hacked out the code, played around with it, and tried to make it produce the expected results.  </p>\n<p>Well, suffice it to say that things have come a long way since the last time I stayed up late banging away on my keyboard.  When I fell back in love with coding a couple of years ago, it was a revolution for me to start poking at Python, learn about callbacks in Javascript, and then have to write tests the first time I made a PR and the reviewer said something to the effect of \"where are the tests for this thing!?\"  I didn't begin to comprehend what all of fancy automated scripts were that popped up on my pull request when I first submitted it and I got a bunch of red Xs from <a href=\"https://travis-ci.org/\">Travis-CI</a> complaining about how my PR would reduce code coverage on the project by 0.03% and that my code didn't build.  It built on my machine, dadgumit!</p>\n<p>Anyway, 2 years later and I still don't really write tests.  But, with Armob being my first major solo project that I'm actually going to try to take to some form of completion, it's about time I really try get a sense for how CI/CD works and how it can make your workflow easier as a coder.  I'm a long way from that, but at least <a href=\"https://github.com/features/actions\">Github Actions</a> (hereafter GA) makes it relatively straightforward to build out some basic automation and I took a first stab at it with what follows.</p>\n<h2>A Github Action for Armob</h2>\n<p>Just to skip right to the end, <a href=\"https://github.com/acolytec3/ArMob/blob/master/.github/workflows/flutter-app-build.yml\">this</a> is the end-state of the Github Action we're building.  What it does is build a release version of both the Android and iOS versions of Armob and then saves the Android apk after each build.  It doesn't save the iOS ipa but that's a grumble for another time.  So, let's walk through this.</p>\n<h3>The Name</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">name: Flutter Build</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>This is just it, the name of the job.  </p>\n<h3>When to do it</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">on:\n  \n  pull_request:\n    branches: [ master ]</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This tells the GA code runner when to run this workflow.  In this case, it's <code class=\"language-text\">on</code> each PR to the <code class=\"language-text\">master</code> branch.</p>\n<h3>The setup</h3>\n<p>Next, we tell GA what environment to run it in.  Since Flutter can build an Android apk equally well on Linux and MacOS, I opted for MacOS so I don't have to have separate build environments for each flavor of the app.  Just set it up like below.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">  build:\n    runs-on: macos-latest</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Next, the actual environment setup.  atWe're using a pre-defined Github Action called <code class=\"language-text\">checkout@master</code> that is basically equivalent to <code class=\"language-text\">git checkout PR-branch</code> where <code class=\"language-text\">PR-branch</code> is the branch of your code where your PR is.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">    steps:\n    - uses: actions/checkout@master</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Next, more environmental stuff - setup the Java dependency for Flutter.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">    - uses: actions/setup-java@v1\n      with:\n        java-version: &#39;12.x&#39;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>Now, we're going to use the very generously maintained Flutter Action template <a href=\"https://github.com/subosito/flutter-action\"><code class=\"language-text\">subosito/flutter-action@v1</code></a> which configures the rest of the Flutter setup needed to build our app.  Note, I'm using the <code class=\"language-text\">dev</code> branch of Flutter because of some dependencies in Armob.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">    - uses: subosito/flutter-action@v1\n      with:\n        channel: &#39;dev&#39; # or: &#39;dev&#39; or &#39;beta&#39;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>Next, we have to grab a <a href=\"https://dart.dev/tools/pub/dependencies#path-packages\">path package</a> that Armob uses.  I have a backend Dart library called <a href=\"https://github.com/acolytec3/libarweave\">libarweave</a> that performs almost all of the interactions with the Arweave blockchain for Armob.  I've never bothered to publish it as a proper Flutter library so my local environment's <code class=\"language-text\">pubspec.yml</code> tells flutter to just grab it from the neighboring folder on the hard drive when building locally.  In order for GA to do this without me having to do any special changes in the GA environment, we have to tell it to clone the repo in the right place in the build environment.  Hence, the next step in our workflow.  Clone the repo and put it in a directory one step up from the main repo (i.e. replicating where it would live in my local environment)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">    - run: git clone https://github.com/acolytec3/libarweave.git ../libarweave</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h3>Building the app</h3>\n<p>Now, to build the app.  The next three steps are just normal Flutter build steps.  1) Get dependencies, 2) Build the Android app, 3) Build the iOS app.  Note, I don't sign the iOS app because I haven't paid the <a href=\"https://developer.apple.com/support/purchase-activation/\">Apple ransom, I mean, developer subscription fee</a>, for the privilege of getting my own provisioning certificate.  See above grumble for another time.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">    - run: flutter pub get\n    - run: flutter build apk --release\n    - run: flutter build ios --release --no-codesign</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>Lastly, let's archive the Android apk so we can grab it later and try it out.  This step uses another prepackaged Github Action template called <code class=\"language-text\">upload-artifact</code>.  Basically, once the app is built, it grabs the output of the <code class=\"language-text\">flutter build apk --release</code> step and makes it available for download as a zip archive on the GA job page.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">    - uses: actions/upload-artifact@v1\n      with:\n        name: android-build\n        path: ./build/app/outputs/apk/release</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 408px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7f9e485c3614b81e7cd47f0735fbdc43/e7c18/uploaded-artifact.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsSAAALEgHS3X78AAABPElEQVQoz7VSy07DMBDsp/ITnPgFfoMf4MARzpwoTRX6EPSRxHESx2mc2HFi7waXh1QEaiMQo7Xly+zMznpkoPcT1NAzxgiJSRzneeEelMZJxvqjGLnzSHBCe0qpN/Unnvey3jzNZg/j8fNqe5r8a+zJSZqut0EYxW3Xaa3jJKVJmqRZWYrTZLnjPKVFRk2rrQUpZV1LqZTWLWJ/pEaIYEWGVYYihabGw87YA6DD+/0df5sZEC7uL29Wd0Z2eVFkLGeMu21ljEvVCFEp1bjhAeAHskV7dnt+Nb9uhV4HwWoTuuzCiGxDUlY157tiV7p2xth/WJVSqpa1y9YCugL4SGjAzACL5dLzps7sl6QHYK/cGeP+RqlsxNuAt6TooqJ12ifrzXajKyFoafyo8YlexHpO9VBl/PR5aBsG4BXbK2njuSwyHgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Uploaded artifact\"\n        title=\"Uploaded artifact\"\n        src=\"/static/7f9e485c3614b81e7cd47f0735fbdc43/e7c18/uploaded-artifact.png\"\n        srcset=\"/static/7f9e485c3614b81e7cd47f0735fbdc43/fac75/uploaded-artifact.png 125w,\n/static/7f9e485c3614b81e7cd47f0735fbdc43/63868/uploaded-artifact.png 250w,\n/static/7f9e485c3614b81e7cd47f0735fbdc43/e7c18/uploaded-artifact.png 408w\"\n        sizes=\"(max-width: 408px) 100vw, 408px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>And that's it!  Now, every time I submit a PR to my <code class=\"language-text\">master</code> branch on Armob, Github automatically runs this action and lets me know if the app can be built.  It's not a complete testing suite by any stretch of the imagination but at least I now know the app can be built for both Android and iOS with every successful run of the job.</p>\n<p>Now, back to hacking!</p>","excerpt":"unsplash-logoJakob Owens Biographical Blah-blah-blah As a mostly self-taught hacker without much in the way of 1337 coding skillz, I've been having to figure…","frontmatter":{"date":"02 May, 2020","path":"/blog/armob_github_actions","title":"My first Github Action - Building Armob","cover":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAID/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQAC/9oADAMBAAIQAxAAAAHXC4zFE//EABkQAQADAQEAAAAAAAAAAAAAAAEAAhEDEv/aAAgBAQABBQKyEbOHSibLdPJhaf/EABURAQEAAAAAAAAAAAAAAAAAAAAS/9oACAEDAQE/AZS//8QAFhEBAQEAAAAAAAAAAAAAAAAAABES/9oACAECAQE/Aa0//8QAGxAAAgEFAAAAAAAAAAAAAAAAABEBEBIhMlH/2gAIAQEABj8C6Yhm1Gh2wf/EABwQAQACAgMBAAAAAAAAAAAAAAEAESFRMUFhkf/aAAgBAQABPyEiz4gLFtUtlDxiayTAsO4CObsn/9oADAMBAAIAAwAAABBPH//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAEDAQE/EIS//8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8QtT//xAAZEAEBAQEBAQAAAAAAAAAAAAABEQAxYSH/2gAIAQEAAT8QgToGj566KqFCqY01vViYkMnmMqwwcXKx5tq7/9k=","aspectRatio":1.4814814814814814,"src":"/static/b4d7fdc028a67d34609faf57faf2a0ab/14b42/action.jpg","srcSet":"/static/b4d7fdc028a67d34609faf57faf2a0ab/f836f/action.jpg 200w,\n/static/b4d7fdc028a67d34609faf57faf2a0ab/2244e/action.jpg 400w,\n/static/b4d7fdc028a67d34609faf57faf2a0ab/14b42/action.jpg 800w,\n/static/b4d7fdc028a67d34609faf57faf2a0ab/47498/action.jpg 1200w,\n/static/b4d7fdc028a67d34609faf57faf2a0ab/0e329/action.jpg 1600w,\n/static/b4d7fdc028a67d34609faf57faf2a0ab/21841/action.jpg 5398w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"fields":{"readingTime":{"text":"5 min read"}}}},"pageContext":{}}}