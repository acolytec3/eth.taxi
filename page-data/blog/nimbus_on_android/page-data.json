{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/nimbus_on_android","result":{"data":{"markdownRemark":{"html":"<p><a style=\"background-color:black;color:white;text-decoration:none;padding:4px 6px;font-family:-apple-system, BlinkMacSystemFont, &quot;San Francisco&quot;, &quot;Helvetica Neue&quot;, Helvetica, Ubuntu, Roboto, Noto, &quot;Segoe UI&quot;, Arial, sans-serif;font-size:12px;font-weight:bold;line-height:1.2;display:inline-block;border-radius:3px\" href=\"https://unsplash.com/@fkaymak?utm_medium=referral&amp;utm_campaign=photographer-credit&amp;utm_content=creditBadge\" target=\"_blank\" rel=\"noopener noreferrer\" title=\"Download free do whatever you want high-resolution photos from Faruk Kaymak\"><span style=\"display:inline-block;padding:2px 3px\"><svg xmlns=\"http://www.w3.org/2000/svg\" style=\"height:12px;width:auto;position:relative;vertical-align:middle;top:-2px;fill:white\" viewBox=\"0 0 32 32\"><title>unsplash-logo</title><path d=\"M10 9V0h12v9H10zm12 5h10v18H0V14h10v9h12v-9z\"></path></svg></span><span style=\"display:inline-block;padding:2px 3px\">Faruk Kaymak</span></a></p>\n<p>Originally posted <a href=\"https://our.status.im/building-nimbus-on-android/\">here</a></p>\n<h1>Building Nimbus on Android</h1>\n<p>Or, how I built an Ethereum client designed for resource-restricted devices on a resource-restricted device.</p>\n<p>Nimbus's tag line is \"an Ethereum 2.0 Sharding Client for Resource-Restricted Devices.\"  My thought when reading this is if it's designed for resource-restricted devices, let's see if we can build it on a resource-restricted device.  And when I say \"resource-restricted device,\" I'm not talking about a Raspberry Pi, though you can certainly <a href=\"https://github.com/status-im/nimbus#raspberry-pi\">build and run Nimbus on a Raspberry Pi</a>.  What I'm talking about is building and running Nimbus on an Android device, in my case, a Oneplus 6T.  What follows is a guided tour of how to get a development environment up and running on your Android device and how leverage that to build and run Nimbus.</p>\n<h2>Environment</h2>\n<p>Before you can build Nimbus, you need something more foundational, a development environment.  </p>\n<h3><a href=\"termux.com\">Termux</a></h3>\n<p>First stop on our road to building Nimbus is <a href=\"termux.com\">Termux</a>.  Termux is a complete Linux distribution packaged up inside an Android app and gives you access to a complete operating system, including a terminal emulator, and even any of several Linux GUIs if you want, no root required.  Once you've installed Termux and fire it up, you'll be greeted with a very familiar site, the Bash terminal prompt.  If you've ever used LInux, this is the same Bash shell you've used on any other distribution under the sun.  So far, so good. </p>\n<p>Now that we have a Linux environment available to us, we need to get all the <a href=\"https://github.com/status-im/nimbus#prerequisites\">Nimbus prerequisite packages</a>.  As a reminder, Nimbus requires RocksDB, PCRE, GNU Make, Git, etc.  The issue is that Termux has a relatively limited set of packages available to it.  While you can install Make, Git, and maybe some of the other needed Posix utilities, any attempt to <code class=\"language-text\">apt install RocksDB</code> will result in an unfriendly <code class=\"language-text\">package not found</code> error message from the Termux package manager.  What's a wouldbe phone coder to do?</p>\n<h3>Ubuntu on Termux</h3>\n<p>Our second stop is to leverage one of Termux's many awesome features, the ability to support <a href=\"https://en.m.wikipedia.org/wiki/Chroot\">chroot</a>.  Since Termux's default package manager doesn't have the packages we need, we're going to have to somehow get access to a package manager that does, which means setting up a guest Linux distribution in a chroot on Termux.  There are a variety of options for other Linux distributions that are supported but we're going with Ubuntu. Follow the instructions <a href=\"https://wiki.termux.com/wiki/Ubuntu\">here</a> to get Ubuntu installed.  Once installed, you can access the Ubuntu environment via the <code class=\"language-text\">start_ubuntu.sh</code> script.  When I installed Ubuntu, that script was located in <code class=\"language-text\">~/jails/ubuntu</code> so I made a simple bash script called <code class=\"language-text\">ub.sh</code> that was placed in my home Termux directory to simplify getting into the Ubuntu environment.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n\n./jails/ubuntu//start-ubuntu.sh</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>Now, we've got the basic OS setup that we need to be able to build Nimbus.  It'd be nice to have a nice code editor to work with like <a href=\"https://code.visualstudio.com/\">VSCode</a> but that isn't possible on your phone, or is it?</p>\n<h3>BLACKICECoder</h3>\n<p>Our last stop on this section of the tour is getting a code editor.  I use Visual Studio Code as my editor of choice and was hunting around the web for something similar to use on my phone.  Sure, there's <a href=\"stackblitz.com\">Stackblitz</a> and <a href=\"codesandbox.io\">Code Sandbox</a> that will theoretically work in your phone's browser, but that's not going to work for building Nimbus locally.  What I stumbled across was a little tool called <a href=\"https://github.com/raynoppe/BLACKICEcoder\">BLACKICECoder</a>.  BlackIceCoder is essentially a stripped down version of VSCode that runs in your phone's browser that is specifically designed to run on Termux.  Follow the instructions on the repo to get it up and running.</p>\n<p>One important note: BlackIceCoder should be installed in your base Termux install and not from within the Ubuntu chroot.</p>\n<p>Below is a simple script that makes starting BlackIceCoder easier.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n\nphp -S <span class=\"token number\">127.0</span>.0.1:1028 -t ~/BLACKICEcoder</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>When you run this script in Termux, open your phone's browser and go to localhost:1028 and the IDE will be ready and waiting for you to get down to coding.</p>\n<h2>Build nimbus</h2>\n<p>Okay, if you've made it this far, we're finally at the point where we ready to actually build an Etheruem client on our phone.  </p>\n<ul>\n<li>First, load up your Ubuntu chroot (simply <code class=\"language-text\">./ub.sh</code> if you built my helper script from above)</li>\n<li>Install the prerequisites: <code class=\"language-text\">apt install librocksdb-dev libpcre3-dev git</code></li>\n<li>Clone the Nimbus repo: <code class=\"language-text\">git clone https://github.com/status-im/nimbus.git</code></li>\n<li>Run <code class=\"language-text\">make</code> to get all the needed submodules</li>\n<li>Run <code class=\"language-text\">make nimbus</code> to build the Nimbus binary. </li>\n</ul>\n<p>If all goes well, you should see output like below:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">root@localhost:~/nimbus<span class=\"token comment\"># make nimbus</span>\nBuilding: build/nimbus\n<span class=\"token punctuation\">[</span>NimScript<span class=\"token punctuation\">]</span> exec: nim c --out:build/nimbus -d:chronicles_log_level<span class=\"token operator\">=</span>TRACE --verbosity:0 --hints:off --warnings:off -d:usePcreHeader --passL:<span class=\"token string\">\"-lpcre\"</span> nimbus/nimbus.nim\nroot@localhost:~/nimbus<span class=\"token comment\">#</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Now, let's see what we can do!</p>\n<h2>Run nimbus</h2>\n<p>This is the moment we've been waiting for.  Run <code class=\"language-text\">build/nimbus</code> to fire up the client.  Below is an example of the output you can expect from the client.  Note, I've turned off discovery and set the log level to TRACE so I can see what the client is doing.  If you just run <code class=\"language-text\">build/nimbus</code> by itself, you probably won't see much output.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">root@localhost:~/nimbus<span class=\"token comment\"># build/nimbus --nodiscover --log-level=TRACE</span>\nNimbus Version <span class=\"token number\">0.0</span>.1 <span class=\"token punctuation\">[</span>linux: arm64, rocksdb, e651975c<span class=\"token punctuation\">]</span>\nCopyright <span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span> <span class=\"token number\">2018</span>-2020 Status Research <span class=\"token operator\">&amp;</span> Development GmbH\nDBG <span class=\"token number\">2020</span>-01-04 01:30:33+00:00 UPnP                                       <span class=\"token assign-left variable\">topics</span><span class=\"token operator\">=</span><span class=\"token string\">\"nat\"</span> <span class=\"token assign-left variable\">tid</span><span class=\"token operator\">=</span><span class=\"token number\">23766</span> <span class=\"token assign-left variable\">file</span><span class=\"token operator\">=</span>nat.nim:64 <span class=\"token assign-left variable\">msg</span><span class=\"token operator\">=</span><span class=\"token string\">\"Internet Gateway Device found.\"</span>\nDBG <span class=\"token number\">2020</span>-01-04 01:30:33+00:00 UPnP: added port mapping                   <span class=\"token assign-left variable\">topics</span><span class=\"token operator\">=</span><span class=\"token string\">\"nat\"</span> <span class=\"token assign-left variable\">tid</span><span class=\"token operator\">=</span><span class=\"token number\">23766</span> <span class=\"token assign-left variable\">file</span><span class=\"token operator\">=</span>nat.nim:122 <span class=\"token assign-left variable\">externalPort</span><span class=\"token operator\">=</span><span class=\"token number\">30303</span> <span class=\"token assign-left variable\">internalPort</span><span class=\"token operator\">=</span><span class=\"token number\">30303</span> <span class=\"token assign-left variable\">protocol</span><span class=\"token operator\">=</span>TCP\nDBG <span class=\"token number\">2020</span>-01-04 01:30:33+00:00 UPnP: added port mapping                   <span class=\"token assign-left variable\">topics</span><span class=\"token operator\">=</span><span class=\"token string\">\"nat\"</span> <span class=\"token assign-left variable\">tid</span><span class=\"token operator\">=</span><span class=\"token number\">23766</span> <span class=\"token assign-left variable\">file</span><span class=\"token operator\">=</span>nat.nim:122 <span class=\"token assign-left variable\">externalPort</span><span class=\"token operator\">=</span><span class=\"token number\">30303</span> <span class=\"token assign-left variable\">internalPort</span><span class=\"token operator\">=</span><span class=\"token number\">30303</span> <span class=\"token assign-left variable\">protocol</span><span class=\"token operator\">=</span>UDP\nINF <span class=\"token number\">2020</span>-01-04 01:30:33+00:00 RLPx listener up                           <span class=\"token assign-left variable\">tid</span><span class=\"token operator\">=</span><span class=\"token number\">23766</span> <span class=\"token assign-left variable\">file</span><span class=\"token operator\">=</span>p2p.nim:87 <span class=\"token assign-left variable\">self</span><span class=\"token operator\">=</span>enode://89e925220f113521a1d6ced3f5ad45575ad7127c7e6307501c00874208e0d8010925d30d3b48ef9715c923a728578a7f1f8e9df3507027f0b76ab99d3e9a30dc@172.72.14.93:30303\nINF <span class=\"token number\">2020</span>-01-04 01:30:33+00:00 Discovery disabled                         <span class=\"token assign-left variable\">tid</span><span class=\"token operator\">=</span><span class=\"token number\">23766</span> <span class=\"token assign-left variable\">file</span><span class=\"token operator\">=</span>p2p.nim:109\nTRC <span class=\"token number\">2020</span>-01-04 01:30:33+00:00 Waiting <span class=\"token keyword\">for</span> <span class=\"token function\">more</span> peers                     <span class=\"token assign-left variable\">tid</span><span class=\"token operator\">=</span><span class=\"token number\">23766</span> <span class=\"token assign-left variable\">file</span><span class=\"token operator\">=</span>p2p.nim:112 <span class=\"token assign-left variable\">peers</span><span class=\"token operator\">=</span><span class=\"token number\">0</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Change nimbus</h2>\n<p>Now, yea, we've finally built Nimbus and gotten it up and running. That's cool and all but throwing BlackIceCoder into the mix is where the magic happens.  Let's get down to coding!</p>\n<ul>\n<li>Open Termux</li>\n<li>Run <code class=\"language-text\">./black.sh</code> and BlackIceCoder will start.</li>\n<li>Open your browser and go to localhost:1028.</li>\n<li>Find the directory where the Nimbus repo lives (probably something like jails->ubuntu->ubuntu-fs->root->nimbus) in the file drawer on the right</li>\n<li>Select whichever file you want to start working on, say <code class=\"language-text\">nimbus.nim</code> and get to work!  You'll see something like the below image.\n<img src=\"/BlackIceCoderNimbus.jpg\" alt=\"BlackIceCoder\"></li>\n<li>Once you've finished your edits, save your changes.</li>\n<li>Switch back to Termux and open a new terminal session by swiping over from the left side of the screen and tapping on \"New Session\"</li>\n<li>Run <code class=\"language-text\">./ub.sh</code> to get to your Ubuntu chroot and navigate to your nimbus repo directory.</li>\n<li>Run <code class=\"language-text\">make nimbus</code> again, run <code class=\"language-text\">build/nimbus</code> and test your changes.  </li>\n</ul>\n<p>And that's it.  Nwow we're actually coding, building, and running Nimbus entirely within a virtual Linux environment on an Android device.  As of this writing, I've actually used this set up for a few commits on a PR I'm making for the Nimbus repo so it actually does work.  It's not a replacement for my main development setup but if I'm away from my PC and have a sudden inspiration or the urge to code, it lets me scratch that itch.</p>\n<h2>Additional notes</h2>\n<p>There are a few things to be aware of when working on Nimbus with the above setup.</p>\n<h3>Nimbus notes</h3>\n<ul>\n<li>The above should theoretically work on any reasonably modern Android device though your mileage will vary if you have a low powered device without alot of space or RAM.  That said, this works pretty well on a reasonably specced device like my Oneplus 6T.</li>\n<li>The <code class=\"language-text\">make nimbus</code> command fails sometimes inexplicably and throws an \"OSError\".  This is probably just a resource constraint issue so don't have lots of other apps running while you're doing this.  Remember, we are running an Ubuntu emulator insde of a Linux emulator inside of an Android app, so just be mindful of the limitations of your device.  </li>\n<li><code class=\"language-text\">make nimbus</code> will probably take a lot longer to compile Nimbus on your phone than on your high-pwoered workstation so don't get frustrated if it takes a couple of minutes to compile.  I've seen it take more than 5 minutes to compile.</li>\n<li>When running Nimbus, remember that you're running this on your phone, so probably best to always run it with the <code class=\"language-text\">--nodiscover</code> argument if you're not connected to Wifi or you might chew up a lot data while it tries to sync whatever chain you're connected to.</li>\n<li>If you run Nimbus, it doesn't really respect the <code class=\"language-text\">Ctrl+c</code> or <code class=\"language-text\">Ctrl+z</code> commands to shut down gracefully.  The only way I've found to kill Nimbus is to open a new terminal window and then run <code class=\"language-text\">killall nimbus</code> from the Termux terminal.  </li>\n</ul>\n<h3>BlackIceCoder notes</h3>\n<ul>\n<li>BlackIceCoder doesn't support syntax highlighting and color for Nim.  That said, it still does autocomplete and parentheses matching like a champ.</li>\n<li>Sometimes, after you've compiled and run Nimbus and then switch back to BlackIceCoder in the browser, you'll find that it's completely refreshed and showing the default screen again rather than still being open to the file you were editing last.  I think this is just a system limitation with how much Android can keep in memory at any one time. As such, always save your changes before switching between the browser and Termux.</li>\n</ul>","excerpt":"unsplash-logoFaruk Kaymak Originally posted here Building Nimbus on Android Or, how I built an Ethereum client designed for resource-restricted devices on a…","frontmatter":{"date":"14 January, 2020","path":"/blog/nimbus_on_android","title":"Building Nimbus on Android","cover":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEAv/EABUBAQEAAAAAAAAAAAAAAAAAAAAD/9oADAMBAAIQAxAAAAHDbl0nMVB//8QAGhAAAgIDAAAAAAAAAAAAAAAAAQIAEhETIf/aAAgBAQABBQLUIrNixluVUkos/8QAFhEBAQEAAAAAAAAAAAAAAAAAABEB/9oACAEDAQE/AYmv/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAERElH/2gAIAQIBAT8BtpKP/8QAGhAAAgIDAAAAAAAAAAAAAAAAAAEQIREiMv/aAAgBAQAGPwLJqkWrLRzH/8QAGxAAAwACAwAAAAAAAAAAAAAAAAEREDFRcZH/2gAIAQEAAT8hdKT60IPJOXhkOksdyCzT9P/aAAwDAQACAAMAAAAQMM//xAAYEQACAwAAAAAAAAAAAAAAAAAAAREhYf/aAAgBAwEBPxBxdM0P/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAEhYf/aAAgBAgEBPxC1Bkf/xAAbEAEAAwADAQAAAAAAAAAAAAABABEhQVFxgf/aAAgBAQABPxDJkdoAfOpaiktufhBdv5LkbGfktAecUgO+d5//2Q==","aspectRatio":1.5151515151515151,"src":"/static/2b4a66d0cd0705a391d855be949b34b3/14b42/clouds.jpg","srcSet":"/static/2b4a66d0cd0705a391d855be949b34b3/f836f/clouds.jpg 200w,\n/static/2b4a66d0cd0705a391d855be949b34b3/2244e/clouds.jpg 400w,\n/static/2b4a66d0cd0705a391d855be949b34b3/14b42/clouds.jpg 800w,\n/static/2b4a66d0cd0705a391d855be949b34b3/47498/clouds.jpg 1200w,\n/static/2b4a66d0cd0705a391d855be949b34b3/0e329/clouds.jpg 1600w,\n/static/2b4a66d0cd0705a391d855be949b34b3/dafff/clouds.jpg 3731w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"fields":{"readingTime":{"text":"8 min read"}}}},"pageContext":{}}}